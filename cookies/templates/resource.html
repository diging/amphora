{% extends "base.html" %}
{% load i18n %}
{% load staticfiles %}
{% load breadcrumbs %}
{% load preview %}
{% load authorization %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'index' %}">{% trans 'Home' %}</a>
    {% breadcrumb_url 'Resources' 'resources' %}
    {% breadcrumb_url resource.name 'resource' resource.id  %}
</div>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-{% if preview_content %}7{% else %}12{% endif %}">
        <div class="resource_summary">
            <div class="h3 resource_name">
                {{ resource.name }}

                <span class="pull-right btn-group">
                    {% if resource.has_giles_content %}
                    <span class="btn">
                        <img style="height: 15px;" src="{% static "cookies/img/giles_logo.png" %}" />
                    </span>
                    {% endif %}
                    <a class="btn glyphicon glyphicon-link" data-toggle="modal" data-target="#uri-modal">
                    </a>
                    {% is_authorized "change_resource" user resource as can_edit_resource %}
                    {% if can_edit_resource %}
                    <a class="btn glyphicon glyphicon-pencil" aria-hidden="true"
                        href="{% url "edit-resource-details" resource.id %}{% if request %}?next={{ request.path }}{% endif %}"
                        data-toggle="tooltip"
                        data-title="Edit record"></a>
                    <a class="btn glyphicon glyphicon-compressed" aria-hidden="true"
                        href="{% url "resource-prune" resource.id %}"
                        data-toggle="tooltip"
                        data-title="Prune duplicate metadata"></a>
                    {% endif %}
                    {% is_authorized "view_authorizations" user resource as can_view_authorizations %}
                </span>

            </div>
            {% if resource.description %}
            <p class="text-muted">{{ resource.description }}</p>
            {% endif %}

            <dl class="dl-horizontal">
                {% if part_of %}
                <dt>Collection</dt>
                <dd><a href="{% url "collection" part_of.id %}">{{ part_of.name }}</a></dd>
                {% endif %}
                <dt>Created</dt>
                <dd>{{ resource.created }}</dd>
                <dt>Created by</dt>
                <dd>{{ resource.created_by }}</dd>
                <dt class="resource_entity_type">Type</dt>
                <dd>{{ resource.entity_type }}</dd>

                {% if resource.content %}
                <dt class="resource_content">Content</dt>
                {% for content_relation in content_relations %}
                <dd>
                    <a href="{% url "resource-content" content_relation.content_resource.id %}">
                        {% if content_relation.content_resource.is_external %}<i class="fa fa-key" aria-hidden="true"></i>{% endif %}
                        {% if content_relation.content_resource.is_remote %}<i class="fa fa-external-link" aria-hidden="true"></i>{% endif %}
                        {% if content_relation.content_resource.is_local %}<i class="fa fa-database" aria-hidden="true"></i>{% endif %}
                        {% url "resource-content" content_relation.content_resource.id %}
                    </a>&nbsp;
                    {% if content_relation.content_type %}
                    <span class="text-warning">
                        {{ content_relation.content_type }}
                    </span>
                    {% endif %}
                </dd>
                {% endfor %}
                {% endif %}
            </dl>

        </div>

        <h3>Metadata</h2>
        <div class="resource_relations">
            <dl class="dl-horizontal">
                {% for relation in relations_from %}
                <dt class="predicate"
                    id="predicate_{{ relation.predicate.id }}"
                    uri="{{ relation.predicate.uri }}">
                    {{ relation.predicate.name }}
                </dt>
                <dd class="target"
                    id="target_{{ relation.target.id }}"
                    uri="{{ relation.target.uri }}">
                    {% with relation.target.get_absolute_url as resource_url %}
                    {% if resource_url %}<a href="{{resource_url}}">{% endif %}{{ relation.target.name }}{% if resource_url %}</a>{% endif %}
                    <span class="label label-default" data-toggle="tooltip" data-title="{{ relation.target.entity_type.schema }}">{{ relation.target.entity_type.name }}</span>
                    {% endwith %}
                </dd>
                {% endfor %}
            </dl>
        </div>
    </div>
    {% if preview_content %}
    <div class="col-md-5">
        {{ resource|preview:request }}
    </div>
    {% endif %}
</div>

<div class="container">
    <dt>Parts</dt>
    {% for relation in part_relations %}
    <dd>
        <a href="{{ relation.source.get_absolute_url }}">{{ relation.source.name }}</a>
    </dd>
    {% endfor %}
</div>



<div class="modal fade" tabindex="-1" role="dialog" id="uri-modal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Permalink</h4>
      </div>
      <div class="modal-body">
          <div class="form-group">
              <div class="input-group">
                <input type="text" class="form-control" id="uri-uri" style="font-family: monospace;" value="{{ resource.uri }}" disabled="disabled" />
                <span class="input-group-btn">
                    <a class="btn" id="copy-to-clipboard">
                        <i class="fa fa-clipboard" aria-hidden="true"></i>
                    </a>
                </span>
            </div>
        </div>
        <div class="text-right" id="message"></div>
      </div>
          <script>
          $('#copy-to-clipboard').click(function () {
                $('#uri-uri').select();
                document.execCommand("copy");
                $('#message').text('Copied to clipboard!');
            });
            </script>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
{% endblock %}
